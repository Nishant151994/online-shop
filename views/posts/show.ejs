<% layout('layouts/post-show-layout') -%>
<h1><%= post.title %></h1>
<div>Price: <%= post.price %></div>
<div><%= post.description %></div>
<div><%= post.location %></div>
<div>
	<% post.images.forEach(function(image) { %>
	<img src="<%= image.url %>" alt="Online Shop Image" width="200px">
	<% }); %>
</div>
<div id='map'></div>
<div>
	<a href="/posts/<%= post.id %>/edit">
		<button>Edit</button>
	</a>
</div>
<div>
	<form action="/posts/<%= post.id %>?_method=DELETE" method="POST">
		<input type="submit" value="Delete">
	</form>
</div>

<h2>Create a review</h2>
<form action="/posts/<%= post.id %>/reviews" method="POST">
	<textarea name="review[body]" required></textarea>
	<input type="number" min="1" max="5" step="1" name="review[rating]" required>
	<input type="submit">
</form>
<h3>Reviews</h3>
<% post.reviews.forEach(function(review) { %>
	<div>
		Author: <%= review.author.username %><br>
		<%= review.body %><br>
		Rating: <%= review.rating %>
	</div>
	<div>
		<button class="toggle-edit-form">Edit</button>

		<form action="/posts/<%= post.id %>/reviews/<%= review.id %>?_method=PUT" method="POST" class="edit-review-form">
			<textarea name="review[body]" required><%= review.body %></textarea>
			<input type="number" min="1" max="5" step="1" name="review[rating]" value="<%= review.rating %>" required>
			<input type="submit" value="Update">
		</form>
	</div>
	<hr>
<% }); %>

<script type="text/javascript">
	$('.toggle-edit-form').on('click', function() {
		// toggle the edit button text on click
		$(this).text() === 'Edit' ? $(this).text('Cancel') : $(this).text('Edit');
		//toggle visibility of the edit review form
		$(this).siblings('.edit-review-form').toggle();
	});
</script>